<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.3">
<title data-rh="true">ASP.NET Core default project structure explained (part 2) | Korzh&#x27;s Blog</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://korzh.com/blog/img/korzh-docs-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://korzh.com/blog/img/korzh-docs-social-card.jpg"><meta data-rh="true" property="og:url" content="https://korzh.com/blog/asp-net-core-project-structure-explained-part2"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="ASP.NET Core default project structure explained (part 2) | Korzh&#x27;s Blog"><meta data-rh="true" name="description" content="This is the second part of the article, where we take apart the default ASP.NET Core solution template piece by piece and try to explain the purpose of each part and how exactly it works. You can consider it as a reference where you can check why a particular part was added to your project and find a link to the relevant documentation that explains it in detail."><meta data-rh="true" property="og:description" content="This is the second part of the article, where we take apart the default ASP.NET Core solution template piece by piece and try to explain the purpose of each part and how exactly it works. You can consider it as a reference where you can check why a particular part was added to your project and find a link to the relevant documentation that explains it in detail."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2020-08-10T00:00:00.000Z"><meta data-rh="true" property="article:tag" content="ASP-NET-CORE,PROJECT-TEMPLATE"><link data-rh="true" rel="icon" href="/blog/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://korzh.com/blog/asp-net-core-project-structure-explained-part2"><link data-rh="true" rel="alternate" href="https://korzh.com/blog/asp-net-core-project-structure-explained-part2" hreflang="en"><link data-rh="true" rel="alternate" href="https://korzh.com/blog/asp-net-core-project-structure-explained-part2" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://korzh.com/blog/asp-net-core-project-structure-explained-part2","mainEntityOfPage":"https://korzh.com/blog/asp-net-core-project-structure-explained-part2","url":"https://korzh.com/blog/asp-net-core-project-structure-explained-part2","headline":"ASP.NET Core default project structure explained (part 2)","name":"ASP.NET Core default project structure explained (part 2)","description":"This is the second part of the article, where we take apart the default ASP.NET Core solution template piece by piece and try to explain the purpose of each part and how exactly it works. You can consider it as a reference where you can check why a particular part was added to your project and find a link to the relevant documentation that explains it in detail.","datePublished":"2020-08-10T00:00:00.000Z","author":[],"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://korzh.com/blog/","name":"Korzh's Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Korzh&#39;s Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Korzh&#39;s Blog Atom Feed"><link rel="stylesheet" href="/blog/assets/css/styles.bd7def6c.css">
<script src="/blog/assets/js/runtime~main.202370fa.js" defer="defer"></script>
<script src="/blog/assets/js/main.cddef3e4.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/blog/img/korzh_logo.png"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/blog/"><div class="navbar__logo"><img src="/blog/img/korzh_logo.png" alt="Korzh&#x27;s Blog logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/blog/img/korzh_logo.png" alt="Korzh&#x27;s Blog logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Korzh&#x27;s Blog</b></a></div><div class="navbar__items navbar__items--right"><a href="https://korzh.com" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">Back to Korzh.com<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default"></div></div></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_brwN thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_r4Q1 margin-bottom--md">All Posts</div><ul class="sidebarItemList_QwSx clean-list"><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/typescript-webpack-aspnetcore">Using TypeScript with WebPack in ASP.NET Core projects</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/single-file-web-service-aspnetcore">Single-file web API services with .NET 5 and ASP.NET Core</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/crud-asp-net-core-with-easydata">CRUD operations in ASP.NET Core with EasyData library</a></li><li class="sidebarItem_lnhn"><a aria-current="page" class="sidebarItemLink_yNGZ sidebarItemLinkActive_oSRm" href="/blog/asp-net-core-project-structure-explained-part2">ASP.NET Core default project structure explained (part 2)</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/asp-net-core-project-structure-explained-part-1">ASP.NET Core default project structure explained (part 1)</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/dotnet-vs-java-what-development-platform-better">.NET vs. Java - Which Platform Is Better for Your Software Developer Career?</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/dependency-injection-explanation-in-simple-words">Dependency Injection Put Simply</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/add-extra-user-claims-aspnet-core-webapp">Add extra user claims in ASP.NET Core webapp</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/embedded-resources-testing-projects">Using embedded resources in testing projects</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/aspnet-identity-master-password">ASP.NET Identity - Adding master password</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/aspnet-identity-migrate-membership-passwords">ASP.NET Identity - Migrating users&#x27; passwords from ASP.NET Membership</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/aspnet-identity-weakening-password-policies">ASP.NET Identity - Weakening password policies</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/aspnet-identity-store-user-data-in-claims">ASP.NET Identity - Use claims to store additional user&#x27;s data</a></li><li class="sidebarItem_lnhn"><a class="sidebarItemLink_yNGZ" href="/blog/Welcome">Welcome</a></li></ul></nav></aside><main class="col col--6"><article><header><h1 class="title_f1Hy">ASP.NET Core default project structure explained (part 2)</h1><div class="container_mt6G margin-vert--md"><time datetime="2020-08-10T00:00:00.000Z">August 10, 2020</time> · <!-- -->11 min read</div></header><div id="__blog-post-container" class="markdown"><p><img decoding="async" loading="lazy" src="/blog/assets/images/computer-coffee-02-3db0865179d3b5ebf4e4295b5b74d3ca.jpg" width="1920" height="1442" class="img_ev3q"></p>
<blockquote>
<p>This is the second part of the <a href="/blog/asp-net-core-default-project-structure-explained-part-1">article</a>, where we take apart the default ASP.NET Core solution template piece by piece and try to explain the purpose of each part and how exactly it works. You can consider it as a reference where you can check why a particular part was added to your project and find a link to the relevant documentation that explains it in detail.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="startup-class">Startup class<a href="#startup-class" class="hash-link" aria-label="Direct link to Startup class" title="Direct link to Startup class">​</a></h2>
<p>As we already mentioned in the first article, the Startup class is the entry point for all initialization codes in your application.
Long story short, the Startup defines what your application will do and how exactly it will work.</p>
<p>By default, any Startup class in the ASP.NET Core application includes three main parts:</p>
<ul>
<li>
<p><strong>The constructor</strong> where you can define some internal variables, set up some configuration settings, or perform application-wide initializations. For example, we suggest our users set here their license keys for our EasyQuery library.</p>
</li>
<li>
<p><strong>ConfigureServices</strong> method. Here we register all necessary services in the DI (dependency injection) container and define the configuration settings for some of them. In case you are not aware of what Dependency Injection is, here is an article on our blog that explains this concept in simple words.</p>
</li>
<li>
<p><strong>Configure</strong> method. This is the stage when you set up the middleware pipeline for your project.</p>
</li>
</ul>
<p>Both <code>ConfigureServices</code> and <code>Configure</code> methods are called automatically while the application starts. You just need to define the services and the middlewares there correspondingly.</p>
<p>Now, let’s take a look at each of these sections more in detail.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="startup-class-constructor">Startup class constructor<a href="#startup-class-constructor" class="hash-link" aria-label="Direct link to Startup class constructor" title="Direct link to Startup class constructor">​</a></h3>
<p>The default ASP.NET Core project template contains only the following one line of code in the constructor:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">        public Startup(IConfiguration configuration)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Configuration = configuration;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It just saves in the class property the <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/configuration/?view=aspnetcore-3.1" target="_blank" rel="noopener noreferrer">configuration object</a>
passed here by the DI container, so we can use it in other methods.
In the <a href="https://korzh.com/blog/asp-net-core-project-structure-explained-part1" target="_blank" rel="noopener noreferrer">first article</a>,
we have already considered the configuration mechanism used in ASP.NET Core applications.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="configureservices-method">ConfigureServices method<a href="#configureservices-method" class="hash-link" aria-label="Direct link to ConfigureServices method" title="Direct link to ConfigureServices method">​</a></h3>
<p>As it was mentioned before, the <code>ConfigureServices</code> method contains the function calls that register different application services in the DI container.
These can be authentication/authorization services, MVC or Razor Pages engine, the classes for working with DB, or any other possible services.</p>
<p>The only parameter of the <code>ConfigureServices</code> method has <code>IServiceCollection</code> type that represents a list of <code>ServiceDescriptor</code> items.
Each of those items maps some type (usually an interface) to a particular implementation of this type.</p>
<p>According to the interface, we can use only usual <code>IList</code> or <code>ICollection</code> functions like <code>Add</code>, <code>AddRange</code>, <code>Remove</code>, and other methods.
However, as you have already noticed, <code>ConfigureServices</code> contains such calls as <code>services.AddDbContext</code>, <code>services.AddRazorPages</code>, and similar.
You may ask, “How is it possible?” The answer is <strong>extension methods</strong>. Each sub-system used in our project (like Entity Framework Core or MVC engine) defines an extension method (sometimes even a few) for the <code>IServiceCollection</code> interface to simplify the registration in the DI and configuration of the services available in that sub-system.</p>
<p><strong>NB</strong>: Please note that the order of the services you register in the <code>ConfigureServices</code> method is not important.
This method is executed only once upon your application start.</p>
<p>So, let&#x27;s take a closer look at the default ConfigureServices’ content.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public void ConfigureServices(IServiceCollection services)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    services.AddDbContext&lt;ApplicationDbContext&gt;(options =&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        options.UseSqlServer(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Configuration.GetConnectionString(&quot;DefaultConnection&quot;)));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    services.AddDefaultIdentity&lt;IdentityUser&gt;(options =&gt; options.SignIn.RequireConfirmedAccount = true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .AddEntityFrameworkStores&lt;ApplicationDbContext&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    services.AddRazorPages();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>So, there are only three calls there: <code>AddDbContext</code>, <code>AddDefaultIdentity</code>, and <code>AddRazorPages</code>. Let’s inspect each of them separately.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="adddbcontext">AddDbContext<a href="#adddbcontext" class="hash-link" aria-label="Direct link to AddDbContext" title="Direct link to AddDbContext">​</a></h4>
<p>This method is provided by the <a href="https://docs.microsoft.com/en-us/ef/core/" target="_blank" rel="noopener noreferrer">Entity Framework Core</a> framework. It registers and configures our database context. The <code>Action</code>delegate passed in the parameter allows us to define the parameters of this DbContext. For example, with <code>UseSqlServer</code> call, we tell our DbContext to use a particular type of connection (<code>SqlConnection</code>) with a particular connection string. The connection string itself is taken from the configuration so it can be easily changed in Development or Production environments. You can find the default connection string in the <code>appsettings.json</code> configuration file, which we already analyzed in the <a href="https://korzh.com/blog/asp-net-core-project-structure-explained-part1" target="_blank" rel="noopener noreferrer">first article</a>.</p>
<h5 class="anchor anchorWithStickyNavbar_LWe7" id="a-few-words-about-the-builder-pattern">A few words about the “Builder” pattern<a href="#a-few-words-about-the-builder-pattern" class="hash-link" aria-label="Direct link to A few words about the “Builder” pattern" title="Direct link to A few words about the “Builder” pattern">​</a></h5>
<p>You may have noticed an interesting way of passing settings for DbContext.
Instead of sending an object with options, we use a procedure (Action) with one-parameter options of the DbContextOptionsBuilder type.</p>
<p>That&#x27;s because, to construct the DbContext settings properly, Entity Framework Core uses the <strong>Builder Pattern</strong>.
This pattern is helpful when you need to perform several steps to construct some complex objects and simply defining a class or structure is not enough. For example, when you need to call some methods depending on the settings in the configuration.
As it happens in our case with <code>UseSqlServer()</code>.</p>
<p>There is one more reason why we use a delegate (function) instead of a plain object.
There may be a situation when you don&#x27;t need that service (DbContext) at all.
For example, your web app has some actions that do not require database access.
The DbContext object will never be created for such requests, and so, we will not need to set its options.
The good thing about a delegate is that it can be called exactly when you need to construct the necessary object.</p>
<p>I paid so much attention to this pattern because it is used quite often,
especially in the process of registering services in DI (and we will use that for the next function call as well).</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="adddefaultidentity">AddDefaultIdentity<a href="#adddefaultidentity" class="hash-link" aria-label="Direct link to AddDefaultIdentity" title="Direct link to AddDefaultIdentity">​</a></h4>
<p>The second function call in the ConfigureServices was added here because of the Authentication option we turned on when creating our project.
It registers a bunch of services for authentication and authorization tasks such as <code>IUserStore</code>, <code>IRoleStore</code>, <code>IPasswordHasher</code>, <code>UserManager</code>, <code>SignInManager</code>, and many others.
The are all part of the ASP.NET Core Identity sub-system.</p>
<p>This method also uses the Builder Pattern, but in a slightly different way. Instead of passing the builder in the delegate’s parameter, this function returns an IdentityBuilder object, so you can call other functions with simple chaining.</p>
<p>The only function called there is <code>AddEntityFrameworkStores</code>.
It tells ASP.NET Identity where to store all the entities required for auth tasks (users, roles, claims, etc.).
As the name of the method suggests, we will use our Entity Framework services for these tasks.
The type of parameter in this method (between <code>&lt; .. &gt;</code>) defines the <code>DbContext</code> class used to store all auth objects.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="addrazorpages">AddRazorPages<a href="#addrazorpages" class="hash-link" aria-label="Direct link to AddRazorPages" title="Direct link to AddRazorPages">​</a></h3>
<p>The last function call in the <code>ConfigureServices</code> adds the services necessary for Razor Pages engine.
It appears here because of the template we chose at the beginning.
If we had selected a template with Model-View-Controller approach at that point, we would have had something like <code>services.AddMvc()</code> here.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configure-method">Configure method<a href="#configure-method" class="hash-link" aria-label="Direct link to Configure method" title="Direct link to Configure method">​</a></h2>
<p>The last method in the Startup class defines the middleware pipeline of our ASP.NET Core program.
If you don&#x27;t know what a middleware pipeline is, you might want to learn more about it because it determines how your web application handles HTTP requests.</p>
<p><img decoding="async" loading="lazy" alt="ASP.NET Core middleware pipeline" src="/blog/assets/images/aspnetcore-middleware-pipeline-87128c7f53aac03d773e86a0c4903c4c.png" width="600" height="384" class="img_ev3q"></p>
<p>Unlike the services registered in <code>ConfigureServices</code> (remember, their order is not important), the order of middlewares defined in <code>Configure</code> has crucial significance. As you can see from the picture above, the first defined middleware is called for each request while every next one in the pipeline processes only those requests that were not processed by the middlewares defined before it.</p>
<p>So at the beginning of the pipeline, we need to place the middlewares that are necessary for auxiliary tasks (like logging or authentication) and that don’t consume a lot of memory and processing time.</p>
<p>Let’s take a look at the default implementation of this method for the chosen project template:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">        public void Configure(IApplicationBuilder app, IWebHostEnvironment env)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (env.IsDevelopment()) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                app.UseDeveloperExceptionPage();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                app.UseDatabaseErrorPage();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                app.UseExceptionHandler(&quot;/Error&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                app.UseHsts();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            app.UseHttpsRedirection();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            app.UseStaticFiles();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            app.UseRouting();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            app.UseAuthentication();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            app.UseAuthorization();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            app.UseEndpoints(endpoints =&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                endpoints.MapRazorPages();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>So, let’s go through the middlewares defined here one by one.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="exception-handling-and-security-transport">Exception handling and security transport<a href="#exception-handling-and-security-transport" class="hash-link" aria-label="Direct link to Exception handling and security transport" title="Direct link to Exception handling and security transport">​</a></h4>
<p>The first lines define different middlewares for Development and Production modes.
If we are in the Development mode, we define the middlewares that catch all exceptions in the pipeline
and show a special page with extra information about the error (exception message, stack trace, etc.).</p>
<p>It&#x27;s possible to do because (as you can see from the image above) the processing of the request is returned to the first middleware
in the pipeline before being sent back to the client.</p>
<p>In the Production mode, we also catch all exceptions and then re-execute the request with the specified path (‘/Error’ in our case).</p>
<p>The second call executed only in Production is <code>UseHsts</code>. It adds a middleware that implements HTTP Strict Transport Security Protocol.</p>
<p>The next in the pipeline is HTTPS redirection middleware (<code>app.UseHttpsRedirection</code>).
The name is self-explanatory. It just redirects all HTTP requests to HTTPS ones.
These two middlewares (<code>app.UseHsts</code> and <code>app.UseHttpsRedirection</code> calls) are added because of the <strong>Configure for HTTPS</strong> option we turned on (actually, it was turned on by default) during the project creation.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="processing-static-files-usestaticfiles">Processing static files (UseStaticFiles)<a href="#processing-static-files-usestaticfiles" class="hash-link" aria-label="Direct link to Processing static files (UseStaticFiles)" title="Direct link to Processing static files (UseStaticFiles)">​</a></h4>
<p>The next middleware (added by the <code>app.UseStaticFiles()</code> call) takes care of all static files.
Simply put, if the application gets a request for some .js, .css, or an image file (.png, .jpg, etc.),
this middleware looks for a file with the requested name inside <code>wwwroot</code> folder and returns it in response (if the file was found).
If not, it sends back a response with a 404 status code (“not found”).</p>
<p>There are overloads of <code>UseStaticFiles</code> that allow us to define another root folder for static files and set some other options.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="routing-userouting-and-useendpoints">Routing (UseRouting and UseEndpoints)<a href="#routing-userouting-and-useendpoints" class="hash-link" aria-label="Direct link to Routing (UseRouting and UseEndpoints)" title="Direct link to Routing (UseRouting and UseEndpoints)">​</a></h4>
<p>The next pair of middlewares are, maybe, the most important ones in the pipeline, since they define the routing for all other endpoints in your web app.</p>
<p>In simple words, they match a particular request to a particular endpoint, a piece of executable code that handles the request.</p>
<p>So, how exactly does it work?</p>
<p>In the <code>Configure</code> method, we call <code>app.UseRouting()</code> to add <code>EndpointRoutingMiddleware</code> to our pipeline.</p>
<p>After that, we call <code>app.UseEndpoints()</code> to add <code>EndpointMiddleware</code> to the pipeline and define the endpoints. Each endpoint is an object that contains (as mentioned above) a delegate (so, a piece of code) that actually handles the request, plus some metadata (like an authorization policy).</p>
<p>We can use such extension methods as <code>MapGet</code>, <code>MapPost</code>, and others to add an endpoint that matches a particular request path or a path template. For example, the following pattern <code>/something/{path*}</code>, will be matched for all requests started with <code>/something/</code>.</p>
<p>Additionally, other services can define their own extension functions that are used to create necessary endpoints. For example, you can use the <code>MapRazorPages</code> function for Razor Pages or <code>MapHub</code> for SingleR. In our <a href="https://github.com/KorzhCom/EasyData" target="_blank" rel="noopener noreferrer">EasyData library</a> we defined <code>MapEasyData</code> function that adds an endpoint for the API that processes all CRUD operations.</p>
<p>When our web app gets a new request (and it’s not processed by any middleware defined before <code>UseRouting</code>), the <code>EndpointRoutingMiddleware</code> matches it to some endpoint. So, one endpoint among all defined at the application start is becoming selected at that moment.</p>
<p>Then <code>EndpointMiddleware</code> actually calls the endpoint’s delegate to handle the request.
Other middlewares that are added after <code>app.UseRouting()</code> but before <code>app.UseEnpoints()</code> can see which endpoint is selected
and can change something (e.g., to apply an authorization policy) before <code>EndpointMiddleware</code> dispatches to the selected endpoint.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="authenticationauthorization-useauthentication-useauthorization">Authentication/Authorization (UseAuthentication, UseAuthorization)<a href="#authenticationauthorization-useauthentication-useauthorization" class="hash-link" aria-label="Direct link to Authentication/Authorization (UseAuthentication, UseAuthorization)" title="Direct link to Authentication/Authorization (UseAuthentication, UseAuthorization)">​</a></h4>
<p>These two middlewares are added in the <code>Configure</code> because of the Authentication option we turned on when we created our project.
As already mentioned above, they already know which endpoint is selected and so can add some additional identity-related information to the request’s context (like filling its <code>User</code> property) or redirect to the “sign-in/sign up” pages if the current request is anonymous but the selected endpoint requires authorization.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="wrapping-up">Wrapping Up<a href="#wrapping-up" class="hash-link" aria-label="Direct link to Wrapping Up" title="Direct link to Wrapping Up">​</a></h2>
<p>So, in this article, I tried to cover all pieces of one of the most-used ASP.NET Core application templates and figure out why they are used and how they work (from a very general point of view).</p>
<p>I hope this information will help you better understand the internal mechanism of the ASP.NET Core framework and make your code more clear and efficient.</p>
<p>Thanks for the reading, and take care!</p></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/asp-net-core">ASP-NET-CORE</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/project-template">PROJECT-TEMPLATE</a></li></ul></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/crud-asp-net-core-with-easydata"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">CRUD operations in ASP.NET Core with EasyData library</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/asp-net-core-project-structure-explained-part-1"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">ASP.NET Core default project structure explained (part 1)</div></a></nav></main><div class="col col--3 right-sidebar"><div class="slick-slider slick-initialized" dir="ltr"><button type="button" data-role="none" class="slick-arrow slick-prev" style="display:block"> <!-- -->Previous</button><div class="slick-list"><div class="slick-track" style="width:700%;left:-100%"><div data-index="-1" tabindex="-1" class="slick-slide slick-cloned" aria-hidden="true" style="width:14.285714285714286%"><div><div class="slider__slide" tabindex="-1" style="width:100%;display:inline-block"><div class="slider__slide-text">Need advanced search or data filtering functionality in your .NET project? EasyQuery to the resque!</div><div><a class="slider__slide-action" href="https://korzh.com/easyquery?utm_source=blog&amp;utm_medium=content&amp;utm_campaign=kblog_banner">Install EasyQuery!</a></div></div></div></div><div data-index="0" class="slick-slide slick-active slick-current" tabindex="-1" aria-hidden="false" style="outline:none;width:14.285714285714286%"><div><div class="slider__slide" tabindex="-1" style="width:100%;display:inline-block"><div class="slider__slide-text">Adaptive CRUD for ASP.NET Core web apps. 10 minutes to set up. Open-source!</div><div><a class="slider__slide-action" href="https://github.com/KorzhCom/EasyData?utm_source=blog&amp;utm_medium=content&amp;utm_campaign=kblog_banner">Get EasyData Now!</a></div></div></div></div><div data-index="1" class="slick-slide" tabindex="-1" aria-hidden="true" style="outline:none;width:14.285714285714286%"><div><div class="slider__slide" tabindex="-1" style="width:100%;display:inline-block"><div class="slider__slide-text">Don&#x27;t build reporting functionality from scratch. Use our ready-made solution template for ASP.NET Core!</div><div><a class="slider__slide-action" href="https://korzh.com/easy-report-starter-kit?utm_source=blog&amp;utm_medium=content&amp;utm_campaign=kblog_banner">Get EasyReport Starter KIT!</a></div></div></div></div><div data-index="2" class="slick-slide" tabindex="-1" aria-hidden="true" style="outline:none;width:14.285714285714286%"><div><div class="slider__slide" tabindex="-1" style="width:100%;display:inline-block"><div class="slider__slide-text">Need advanced search or data filtering functionality in your .NET project? EasyQuery to the resque!</div><div><a class="slider__slide-action" href="https://korzh.com/easyquery?utm_source=blog&amp;utm_medium=content&amp;utm_campaign=kblog_banner">Install EasyQuery!</a></div></div></div></div><div data-index="3" tabindex="-1" class="slick-slide slick-cloned" aria-hidden="true" style="width:14.285714285714286%"><div><div class="slider__slide" tabindex="-1" style="width:100%;display:inline-block"><div class="slider__slide-text">Adaptive CRUD for ASP.NET Core web apps. 10 minutes to set up. Open-source!</div><div><a class="slider__slide-action" href="https://github.com/KorzhCom/EasyData?utm_source=blog&amp;utm_medium=content&amp;utm_campaign=kblog_banner">Get EasyData Now!</a></div></div></div></div><div data-index="4" tabindex="-1" class="slick-slide slick-cloned" aria-hidden="true" style="width:14.285714285714286%"><div><div class="slider__slide" tabindex="-1" style="width:100%;display:inline-block"><div class="slider__slide-text">Don&#x27;t build reporting functionality from scratch. Use our ready-made solution template for ASP.NET Core!</div><div><a class="slider__slide-action" href="https://korzh.com/easy-report-starter-kit?utm_source=blog&amp;utm_medium=content&amp;utm_campaign=kblog_banner">Get EasyReport Starter KIT!</a></div></div></div></div><div data-index="5" tabindex="-1" class="slick-slide slick-cloned" aria-hidden="true" style="width:14.285714285714286%"><div><div class="slider__slide" tabindex="-1" style="width:100%;display:inline-block"><div class="slider__slide-text">Need advanced search or data filtering functionality in your .NET project? EasyQuery to the resque!</div><div><a class="slider__slide-action" href="https://korzh.com/easyquery?utm_source=blog&amp;utm_medium=content&amp;utm_campaign=kblog_banner">Install EasyQuery!</a></div></div></div></div></div></div><button type="button" data-role="none" class="slick-arrow slick-next" style="display:block"> <!-- -->Next</button><ul style="display:block" class="slick-dots"><li class="slick-active"><button>1</button></li><li><button>2</button></li><li><button>3</button></li></ul></div><h4 style="margin-top:40px">Table of Contents</h4><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#startup-class" class="table-of-contents__link toc-highlight">Startup class</a><ul><li><a href="#startup-class-constructor" class="table-of-contents__link toc-highlight">Startup class constructor</a></li><li><a href="#configureservices-method" class="table-of-contents__link toc-highlight">ConfigureServices method</a></li><li><a href="#addrazorpages" class="table-of-contents__link toc-highlight">AddRazorPages</a></li></ul></li><li><a href="#configure-method" class="table-of-contents__link toc-highlight">Configure method</a></li><li><a href="#wrapping-up" class="table-of-contents__link toc-highlight">Wrapping Up</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__links text--center"><div class="footer__links"><a href="https://korzh.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">HOME<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">·</span><a href="https://korzh.com/easyquery" target="_blank" rel="noopener noreferrer" class="footer__link-item">EASYQUERY<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">·</span><a href="https://korzh.com/metroui" target="_blank" rel="noopener noreferrer" class="footer__link-item">METRO UI<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">·</span><a href="https://korzh.com/localizer" target="_blank" rel="noopener noreferrer" class="footer__link-item">LOCALIZER<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">·</span><a href="https://korzh.com/blog" target="_blank" rel="noopener noreferrer" class="footer__link-item">BLOG<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">·</span><a href="https://korzh.com/support" target="_blank" rel="noopener noreferrer" class="footer__link-item">SUPPORT<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">·</span><a href="https://korzh.com/resellers" target="_blank" rel="noopener noreferrer" class="footer__link-item">RESELLER FAQ<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">·</span><a href="https://korzh.com/account" target="_blank" rel="noopener noreferrer" class="footer__link-item">YOUR ACCOUNT<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">·</span><a href="https://korzh.com/privacy" target="_blank" rel="noopener noreferrer" class="footer__link-item">PRIVACY<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">·</span><a href="https://korzh.com/terms" target="_blank" rel="noopener noreferrer" class="footer__link-item">TERMS OF USE<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">·</span><a href="https://korzh.com/license" target="_blank" rel="noopener noreferrer" class="footer__link-item">LICENSE<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div></div><div class="footer__bottom text--center"><hr><div class="footer__copyright">Copyright © 1998-2024 Korzh.com.</div><div class="secondary-text">All Rights Reserved</div><div class="secondary-text">All product names, logos, and brands are the property of their respective owners.</div></div></div></footer></div>
</body>
</html>